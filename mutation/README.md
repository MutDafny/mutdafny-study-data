# Mutation

Perform mutation testing on Dafny programs.

## Scripts

- [`scripts/run-scan.sh`](scripts/run-scan.sh), given a Dafny program (i.e., a .dfy file) and a mutation operator, this script generates the set of target locations to mutate, in a nutshell, it runs MutDafny's `scan` command.

Usage example:

```bash
bash "scripts/run-scan.sh" \
  --input_file_path "$(pwd)/../.third-parties/dafnybench/DafnyBench/dataset/ground_truth/630-dafny_tmp_tmpz2kokaiq_Solution.dfy" \
  --mutation_operator AOR \
  --output_directory_path "$(pwd)/data/generated/scan/data/AOR/DafnyBench/630-dafny_tmp_tmpz2kokaiq_Solution/"
```

**Note:** The script [`scripts/gen-scan-jobs.sh`](scripts/gen-scan-jobs.sh) automatizes the process of running the [`scripts/run-scan.sh`](scripts/run-scan.sh) script on **all** programs listed in [`../subjects/data/generated/subjects-whitelist.csv`](../subjects/data/generated/subjects-whitelist.csv) on one or more mutation operators.

- [`scripts/run-mut.sh`](scripts/run-mut.sh), given a Dafny program (i.e., a .dfy file) and a set of mutation targets, this script generated all mutants defined in the set, in a nutshell, it runs MutDafny's `mut` command and writes the generated mutants to the provided output directory.

Usage example:

```bash
bash "scripts/run-mut.sh" \
  --input_file_path "$(pwd)/../.third-parties/dafnybench/DafnyBench/dataset/ground_truth/630-dafny_tmp_tmpz2kokaiq_Solution.dfy" \
  --targets_file_path "$(pwd)/data/generated/scan/data/AOR/DafnyBench/630-dafny_tmp_tmpz2kokaiq_Solution/targets.csv" \
  --output_file_path "$(pwd)/data/generated/mut/data/AOR/DafnyBench/630-dafny_tmp_tmpz2kokaiq_Solution/data.csv" \
  --output_directory_path "$(pwd)/data/generated/mut/mutants/AOR/DafnyBench/630-dafny_tmp_tmpz2kokaiq_Solution/"
```

**Note:** The script [`scripts/gen-run-jobs.sh`](scripts/gen-run-jobs.sh) automatizes the process of running the [`scripts/run-mut.sh`](scripts/run-mut.sh) script on **all** programs listed in [`../subjects/data/generated/subjects-whitelist.csv`](../subjects/data/generated/subjects-whitelist.csv) on **all** sets of mutation targets generated by the [`scripts/run-scan.sh`](scripts/run-scan.sh) script.

## Data

Note: the structure of each CVS file is explained in the [data/FILE-SPECS.md](data/FILE-SPECS.md) file.

Data files generated by the [`scripts/run-scan.sh`](scripts/run-scan.sh) script:
- `data/generated/scan/data/<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>/<Benchmark name>/<Dafny program name>/data.csv`, runtime data of the execution of MutDafny's `scan` command.
- `data/generated/scan/data/<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>/<Benchmark name>/<Dafny program name>/targets.csv`, set of mutation targets.

Data files generated by the [`scripts/run-mut.sh`](scripts/run-mut.sh) script:
- `data/generated/mut/data/<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>/<Benchmark name>/<Dafny program name>/data.csv`, runtime data of the execution of MutDafny's `mut` command.
- `data/generated/mut/mutants/<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>/<Benchmark name>/<Dafny program name>/`, mutants (each in a .dfy file) generated by MutDafny. A mutant is either named as:
  * `<Dafny program name>_<position>_<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>`, e.g., `630-dafny_tmp_tmpz2kokaiq_Solution_141-230_LBI.dfy`
  * `<Dafny program name>_<position>_<mutation operator, AOR|ROR|COR|LOR|SOR|BBR|AOI|COI|LOI|AOD|COD|LOD|LVR|EVR|VER|LSR|LBI|MRR|MAP|MNR|MCR|MVR|SAR|CIR|CBR|CBE|TAR|DCR|SDL|VDL|SLD|ODL|THI|THD|AMR|MMR|FAR|PRV|SWS|SWV>_<mutant>`, e.g., `630-dafny_tmp_tmpz2kokaiq_Solution_1391_LSR_continue.dfy`
`position`, `mutation operator`, and `mutant` are defined in the `targets.csv` file.

## Statistics

- [`statistics/mutants.R`](statistics/mutants.R), plots the distribution number of mutants per mutation operator.
- [`statistics/mutants-gen.R`](statistics/mutants-gen.R), plots the distribution of MutDafny's runtime at generating mutants.
- [`statistics/mutants-status.R`](statistics/mutants-status.R), computes and prints out, as a latex table, the number of generated mutants, the number of killed, survived, invalid, and timeout mutants per mutation operator; and plots the distribution of mutation scores.
- [`statistics/mutants-stat-test.R`](statistics/mutants-stat-test.R), runs two statistical tests (i.e., t.test and wilcox.test) on the mutation data generated by the previously proposed mutation operators vs our proposed mutation operators.
